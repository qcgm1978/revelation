import{g as h}from"./index-fn7NKjN7.js";const l="https://ark.cn-beijing.volces.com/api/v3/chat/completions",m="doubao-1-5-pro-32k-250115",y=()=>localStorage.getItem("DOUBAO_API_KEY")||"",g=async r=>{var t;if(!r.ok)throw new Error(`API request failed with status ${r.status}`);const e=(t=r.body)==null?void 0:t.getReader();if(!e)throw new Error("No response body");return e},A=r=>{var e;try{const t=r.split(`
`);let a="";for(const n of t)if(n.trim()!==""&&n.startsWith("data:")){const c=n.substring(5).trim();if(c==="[DONE]")break;const o=(e=JSON.parse(c).choices[0])==null?void 0:e.delta;o!=null&&o.content&&(a+=o.content)}return a}catch(t){return console.error("Error parsing chunk:",t),""}};async function*w(r,e="zh",t,a){const n=y();if(!n){yield"请先设置豆包 API Key";return}const c=h(r,e,t,a);try{const s=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:m,messages:[{role:"user",content:c}],stream:!0})}),o=await g(s),i=new TextDecoder;for(;;){const{done:p,value:u}=await o.read();if(p)break;const f=i.decode(u,{stream:!0}),d=A(f);d&&(yield d)}}catch(s){yield`错误: ${s instanceof Error?s.message:"豆包服务请求失败"}. ${e==="zh"?"请配置有效的豆包 API Key":"Please configure valid Doubao API Key"}`}}export{w as streamDefinition};
