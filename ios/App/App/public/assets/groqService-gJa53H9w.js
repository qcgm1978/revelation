import{g as A}from"./index-fn7NKjN7.js";var y={};const O="https://api.groq.com/openai/v1/chat/completions",R="meta-llama/llama-4-maverick-17b-128e-instruct";function I(){if(typeof window<"u"&&window.localStorage){const o=localStorage.getItem("GROQ_API_KEY");if(o)return o}if(typeof process<"u"&&y)return y.GROQ_API_KEY}async function*G(o,s="zh",h,_){var a,c,d,f;const i=I();let e="";if(!i){yield"Error: GROQ_API_KEY is not configured. Please configure your API key in the settings to continue.";return}const P=A(o,s,h,_);try{const r=await fetch(O,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:R,messages:[{role:"user",content:P}],stream:!0,max_tokens:1e3,temperature:.7,top_p:.95})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=(a=r.body)==null?void 0:a.getReader();if(!n)throw new Error("Response body is not readable");const l=new TextDecoder;let t="";try{for(;;){const{done:E,value:w}=await n.read();if(E)break;t+=l.decode(w,{stream:!0});const u=t.split(`
`);t=u.pop()||"";for(const p of u)if(p.startsWith("data: ")){const m=p.slice(6);if(m==="[DONE]"){e&&(yield e,e="");return}const g=JSON.parse(m);(f=(d=(c=g.choices)==null?void 0:c[0])==null?void 0:d.delta)!=null&&f.content&&(e+=g.choices[0].delta.content,e.length>=40&&(yield e,e=""))}}}finally{e&&(yield e),n.releaseLock()}}catch(r){e&&(yield e),console.error("Error streaming from Groq:",r);const t=`Error: ${r instanceof Error?r.message:"An unknown error occurred."}. ${s==="zh"?"请配置有效的GROQ_API_KEY或检查VPN设置":"Please configure a valid GROQ_API_KEY or check your VPN settings"}`;throw new Error(t)}}export{G as streamDefinition};
