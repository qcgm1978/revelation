import{g as K}from"./index-fn7NKjN7.js";var m={};const S="https://api.deepseek.com/v3.1_terminus_expires_on_20251015/chat/completions",k="deepseek-chat";function A(){try{if(typeof window<"u"&&window.localStorage){const r=localStorage.getItem("DEEPSEEK_API_KEY");if(r)return r}if(typeof process<"u"&&m)return m.DEEPSEEK_API_KEY}catch(r){console.error("Error getting DeepSeek API key:",r)}}async function*I(r,n="zh",y,P){var d,p,f,u;const E=A();let s="";if(!E){yield"Error: DEEPSEEK_API_KEY is not configured. Please configure your API key in the settings to continue.";return}const _=K(r,n,y,P);try{const e=await fetch(S,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({model:k,messages:[{role:"user",content:_}],stream:!0,max_tokens:500,temperature:.7})});if(!e.ok)throw new Error(await e.json().then(a=>a.error.message));const o=(d=e.body)==null?void 0:d.getReader();if(!o)throw new Error("Response body is not readable");const i=new TextDecoder;let c="";try{for(;;){const{done:a,value:w}=await o.read();if(a)break;c+=i.decode(w,{stream:!0});const l=c.split(`
`);c=l.pop()||"";for(const g of l)if(g.startsWith("data: ")){const h=g.slice(6);if(h==="[DONE]")break;try{const t=JSON.parse(h);(u=(f=(p=t.choices)==null?void 0:p[0])==null?void 0:f.delta)!=null&&u.content&&(s+=t.choices[0].delta.content,yield s,s="")}catch(t){console.error("Error parsing DeepSeek response:",t)}}}}finally{o.releaseLock()}}catch(e){console.error("Error in DeepSeek stream:",e instanceof Error?e.message:"An unknown error occurred");const o=n==="zh"?"请配置DEEPSEEK_API_KEY":"Please configure DEEPSEEK_API_KEY",i=`Error: ${e.message?e.message:"An unknown error occurred."}. ${o}`;throw new Error(i)}}export{I as streamDefinition};
